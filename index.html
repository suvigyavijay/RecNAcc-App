<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>RecNAcc App | DVM</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body>
  <sideNav>
    <ul id="slide-out" class="side-nav fixed primary-color">
      <li class="row constant">
        <br>
        <div class="col s6 offset-s3">
          <img src="img/logo_dvm.svg">
        </div>
      </li>
      <div class="row variable" id="navMenu">
        <li><a href="#" class="white-text"><i class="material-icons md-light white-text">vpn_key</i>Login</a></li>
      </div>
    </ul>
    <a href="#" data-activates="slide-out" class="button-collapse btn-floating btn-large primary-color"><i class="material-icons">menu</i></a>
  </sideNav>
  <main>
    <div class="container">
      <div class="vertical-align center-align" id="loginForm">
        <div class="row red-text" id="loginError">

        </div>
        <div class="row">
          <div class="input-field col s12 m6 offset-m3 left-align">
            <input id="email" type="email" class="validate" value="a@a.asd">
            <label for="email">Email</label>
          </div>
          <div class="input-field col s12 m6 offset-m3 left-align">
            <input id="password" type="password" class="validate" value="qwerty" onkeypress="handleLogin(event)">
            <label for="password">Password</label>
          </div>
        </div>
        <div class="row">
          <button class="btn waves-effect waves-light col s4 offset-s8 m2 offset-m7" type="submit" name="action" id="loginButton" >Login
            <i class="material-icons right">send</i>
          </button>
        </div>
      </div>
      <div id="loggedIn hidden">
        <div id="plsSelect" class="vertical-align">
          <div class="row">
            <a class="waves-effect waves-light btn-large col s12 m6 offset-m3" id="dcButton"><i class="material-icons left">domain</i>Department/Club</a>
          </div>
          <div class="row">
            <a class="waves-effect waves-light btn-large col s12 m6 offset-m3"><i class="material-icons left">shopping_cart</i>Tender D/C</a>
          </div>
          <div class="row">
            <a class="waves-effect waves-light btn-large col s12 m6 offset-m3"><i class="material-icons left">local_hotel</i>Matress D/C</a>
          </div>
        </div>
        <div id="deptClub" class="hidden">
          <div id="dcS1">
            <div class="vertical-align">
              <div class="row">
                <div class="input-field col s12 m6 offset-m3">
                  <input id="uniqueCode" type="text" class="validate" maxlength="6" onkeypress="handleUC(event)">
                  <label for="uniqueCode">Unique Code</label>
                </div>
              </div>
              <div class="row">
                <button class="btn waves-effect waves-light col s4 offset-s8 m2 offset-m7" type="submit" name="action" id="ucButton">Submit
                  <i class="material-icons right">send</i>
                </button>
              </div>
            </div>
          </div>
          <div id="dcS2" class="hidden">
            <div class="vertical-align">
              <h3 class="dc-name center-align" id="dcName"></h3>
              <div class="row">
                <a class="waves-effect waves-light btn-large col s12 m6 offset-m3" onclick=""><i class="material-icons left">mode_edit</i>New Entry</a>
              </div>
              <div class="row">
                <a class="waves-effect waves-light btn-large col s12 m6 offset-m3"><i class="material-icons left">assignment_return</i>Return</a>
              </div>
              <div class="row">
                <a class="waves-effect waves-light btn-large col s12 m6 offset-m3"><i class="material-icons left">history</i>View History/Summary</a>
              </div>
            </div>
          </div>
          <div id="dc_entry" class="hidden">
            <div class="row">
              <div class="input-field col s12 m6 offset-m3">
                <input id="last_name" type="text" class="validate">
                <label for="last_name">Last Name</label>
              </div>
            </div>
          </div>
          <div id="dc_return">

          </div>
          <div id="dc_summary">

          </div>
        </div>
        <div id="tenderDC" class="hidden">

        </div>
        <div id="matressDC" class="hidden">

        </div>
      </div>
    </div>
  </main>
  <footer>

  </footer>

  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
  <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBxzLUFVpUeT3mejr3k35D39vtsicJVYvw",
    authDomain: "recnacc-app.firebaseapp.com",
    databaseURL: "https://recnacc-app.firebaseio.com",
    storageBucket: "recnacc-app.appspot.com",
    messagingSenderId: "174568663971"
  };
  firebase.initializeApp(config);
</script>
<script type="text/javascript">

  function login(email,password) {
    firebase.auth().signInWithEmailAndPassword(email, password).then(
      function() {
        $('#loginError').html('');
        $('#loginForm').fadeOut();
        console.log('Login Successful!');
        var navlist = '<li><a href="#" class="white-text"><i class="material-icons md-light white-text">domain</i>Department/Club</a></li><li><a href="#" class="white-text"><i class="material-icons md-light white-text">shopping_cart</i>Tender D/C</a></li><li><a href="#" class="white-text"><i class="material-icons md-light white-text">local_hotel</i>Matress D/C</a></li><li><a href="#" class="white-text" onclick="logout()"><i class="material-icons md-light white-text">vpn_key</i>Logout</a></li>';
        $('#navMenu').html(navlist);
        $('#loggedIn').fadeIn();
      },
      function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      console.log(errorMessage);
      $('#loginError').html(errorMessage);
    });
  }

  function logout() {
    firebase.auth().signOut().then(function() {
      $('#loggedIn').fadeOut();
      $('#loginForm').fadeIn();
      var navlist = '<li><a href="#" class="white-text"><i class="material-icons md-light white-text">vpn_key</i>Login</a></li>';
      $('#navMenu').html(navlist);
      console.log('Logout Successful!');
    }, function(error) {
      Materialize.toast('An Error Occured. Please Try Again');
    });
  }

  function accessDC(uniqueCode) {
    firebase.database().ref('deptClub/'+uniqueCode).on('value',function(snapshot) {
      console.log(snapshot.val().name);
      $('header').show();
      $('#dcName').html(snapshot.val().name);
      $('#dcS2').show();
    })
  }

  $('#dcButton').click(function() {
    $('#plsSelect').fadeOut();
    $('#deptClub').fadeIn();
  })

  function handleLogin(e){
    if(e.keyCode === 13){
       e.preventDefault(); // Ensure it is only this code that rusn
       $('#loginButton').click();
     }
   }

   function handleUC(e){
    if(e.keyCode === 13){
      e.preventDefault(); // Ensure it is only this code that rusn
      $('#ucButton').click();
    }
  }

  $('#loginButton').click(function(e) {
    var email = $('#email').val();
    var password = $('#password').val();
    login(email, password);
  });

  $('#ucButton').click(function () {
    var uniqueCode = $('#uniqueCode').val();
    accessDC(uniqueCode);
    $('#dcS1').fadeOut();
  })
</script>

</body>
</html>
